#!/bin/bash
set -e
set -x

echo Enter a new role name
read -r role_name

echo

PS3='Select a molecule test driver: '
options=("vagrant" "docker" "quit")
select opt in "${options[@]}"
do
    case $opt in
        "vagrant")
            driver="vagrant"
            break
            ;;
        "docker")
            driver="docker"
            break
            ;;
        "quit")
            break
            ;;
        *) echo invalid option;;
    esac
done

repo_root="$(dirname "$(dirname "$(readlink -fm "$0")")")"

cp -r "$repo_root/roles/templates/$driver" "$repo_root/roles/$role_name"
sed -i "s/$driver/$role_name/g" "$repo_root/roles/$role_name/molecule/default/playbook.yml"
